<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
        font-family: 'Inter', sans-serif;
        background: #0f172a;
        color: #e2e8f0;
        display: flex;
        min-height: 100vh;
    }

    .sidebar {
        width: 280px;
        background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
        padding: 2rem;
        border-right: 1px solid #334155;
        position: fixed;
        height: 100vh;
        overflow-y: auto;
    }

    .logo {
        font-size: 1.8rem;
        font-weight: 800;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 3rem;
    }

    .stat-card {
        background: linear-gradient(135deg, #667eea, #764ba2);
        padding: 1.5rem;
        border-radius: 16px;
        margin-bottom: 1.5rem;
    }

    .stat-label {
        font-size: 0.9rem;
        opacity: 0.9;
        margin-bottom: 0.5rem;
    }

    .stat-value {
        font-size: 2.5rem;
        font-weight: 800;
    }

    .nav-item {
        padding: 1rem;
        margin: 0.5rem 0;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: rgba(100, 116, 139, 0.1);
    }

    .nav-item:hover, .nav-item.active {
        background: rgba(102, 126, 234, 0.2);
        transform: translateX(5px);
    }

    .nav-item.active {
        border-left: 3px solid #667eea;
    }

    .main {
        margin-left: 280px;
        flex: 1;
        padding: 3rem;
    }

    .header {
        margin-bottom: 3rem;
    }

    .header h1 {
        font-size: 2.5rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .header p {
        color: #94a3b8;
        font-size: 1.1rem;
    }

    .grid {
        display: grid;
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .card {
        background: #1e293b;
        border-radius: 20px;
        padding: 2rem;
        border: 1px solid #334155;
        transition: all 0.3s ease;
    }

    .card:hover {
        border-color: #667eea;
        transform: translateY(-4px);
        box-shadow: 0 20px 40px rgba(102, 126, 234, 0.2);
    }

    .card h2 {
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
        color: #f1f5f9;
    }

    input, textarea {
        width: 100%;
        padding: 1rem;
        margin: 0.8rem 0;
        background: #0f172a;
        border: 2px solid #334155;
        border-radius: 12px;
        color: #e2e8f0;
        font-size: 1rem;
        transition: all 0.3s ease;
    }

    input:focus, textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
    }

    input::placeholder, textarea::placeholder {
        color: #64748b;
    }

    input[type="file"] {
        padding: 0.8rem;
        cursor: pointer;
    }

    button {
        width: 100%;
        padding: 1rem;
        margin: 0.8rem 0;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        border-radius: 12px;
        font-weight: 700;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    button:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }

    button:disabled {
        background: #334155;
        cursor: not-allowed;
        opacity: 0.5;
    }

    button.danger {
        background: linear-gradient(135deg, #ef4444, #dc2626);
    }

    button.danger:hover {
        box-shadow: 0 10px 30px rgba(239, 68, 68, 0.4);
    }

    button.secondary {
        background: #334155;
    }

    button.secondary:hover {
        background: #475569;
    }

    .product-item {
        background: #0f172a;
        padding: 1.5rem;
        border-radius: 16px;
        margin-bottom: 1rem;
        border: 1px solid #334155;
        transition: all 0.3s ease;
        display: grid;
        grid-template-columns: 80px 1fr auto;
        gap: 1.5rem;
        align-items: center;
    }

    .product-item:hover {
        border-color: #667eea;
        transform: translateX(5px);
    }

    .product-img {
        width: 80px;
        height: 80px;
        border-radius: 12px;
        object-fit: cover;
        background: #334155;
    }

    .product-info h3 {
        font-size: 1.2rem;
        margin-bottom: 0.5rem;
        color: #f1f5f9;
    }

    .product-meta {
        color: #94a3b8;
        font-size: 0.9rem;
    }

    .product-actions {
        display: flex;
        gap: 0.5rem;
    }

    .product-actions button {
        width: auto;
        padding: 0.6rem 1.2rem;
        margin: 0;
        font-size: 0.9rem;
    }

    .order-item {
        background: #0f172a;
        padding: 1.5rem;
        border-radius: 16px;
        margin-bottom: 1rem;
        border: 1px solid #334155;
        transition: all 0.3s ease;
    }

    .order-item:hover {
        border-color: #667eea;
    }

    .order-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .order-id {
        font-weight: 700;
        color: #667eea;
        font-size: 1.1rem;
    }

    .order-total {
        font-size: 1.5rem;
        font-weight: 800;
        color: #10b981;
    }

    .customer-info {
        color: #94a3b8;
        margin-bottom: 1rem;
        line-height: 1.6;
    }

    .empty-state {
        text-align: center;
        padding: 3rem;
        color: #64748b;
    }

    .empty-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.3;
    }

    .badge {
        display: inline-block;
        padding: 0.4rem 0.8rem;
        background: rgba(102, 126, 234, 0.2);
        color: #667eea;
        border-radius: 8px;
        font-size: 0.85rem;
        font-weight: 600;
        margin-left: 0.5rem;
    }

    .success-badge {
        background: rgba(16, 185, 129, 0.2);
        color: #10b981;
    }

    .warning-badge {
        background: rgba(251, 191, 36, 0.2);
        color: #fbbf24;
    }

    /* Modal Styles */
    .modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        z-index: 3000;
        padding: 2rem;
        overflow-y: auto;
        animation: fadeIn 0.3s ease;
    }

    .modal-content {
        background: #1e293b;
        max-width: 600px;
        margin: 2rem auto;
        border-radius: 24px;
        padding: 2.5rem;
        border: 1px solid #334155;
        position: relative;
        animation: slideUp 0.4s ease;
    }

    .modal h2 {
        font-size: 1.8rem;
        font-weight: 800;
        margin-bottom: 2rem;
        color: #f1f5f9;
    }

    .modal-close {
        position: absolute;
        top: 1.5rem;
        right: 1.5rem;
        background: #334155;
        color: #94a3b8;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        padding: 0;
        margin: 0;
    }

    .modal-close:hover {
        background: #475569;
        color: #f1f5f9;
        transform: rotate(90deg);
    }

    .image-preview {
        width: 100%;
        max-height: 200px;
        object-fit: contain;
        border-radius: 12px;
        margin: 1rem 0;
        background: #0f172a;
    }

    .order-items-list {
        background: #0f172a;
        padding: 1.5rem;
        border-radius: 12px;
        margin: 1rem 0;
    }

    .order-item-row {
        display: flex;
        justify-content: space-between;
        padding: 0.8rem 0;
        border-bottom: 1px solid #334155;
    }

    .order-item-row:last-child {
        border-bottom: none;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(50px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .animate-in {
        animation: slideIn 0.5s ease;
    }

    @media (max-width: 1024px) {
        .sidebar {
            width: 100%;
            position: relative;
            height: auto;
        }
        .main {
            margin-left: 0;
        }
        .product-item {
            grid-template-columns: 1fr;
        }
        .product-actions {
            width: 100%;
            flex-direction: column;
        }
        .product-actions button {
            width: 100%;
        }
    }
</style>
</head>
<body>

<div class="sidebar">
    <div class="logo">ADMIN</div>
    
    <div class="stat-card">
        <div class="stat-label">Total Revenue</div>
        <div class="stat-value" id="totalRevenue">$0.00</div>
    </div>

    <div class="nav-item" onclick="scrollToSection('products')">üì¶ Products</div>
    <div class="nav-item" onclick="scrollToSection('orders')">üõçÔ∏è Orders</div>
    <div class="nav-item" onclick="scrollToSection('settings')">‚öôÔ∏è Settings</div>
</div>

<div class="main">
    <div class="header">
        <h1>Dashboard</h1>
        <p>Manage your store products and orders</p>
    </div>

    <div class="grid">
        <div class="card animate-in" id="add-product">
            <h2>‚ûï Add New Product</h2>
            <input id="pName" placeholder="Product Name">
            <input type="number" id="pPrice" placeholder="Price" step="0.01">
            <input type="number" id="pStock" placeholder="Stock Quantity">
            <input type="file" id="pImg" accept="image/*">
            <button id="saveBtn">Add Product</button>
        </div>

        <div class="card animate-in" style="animation-delay: 0.1s" id="products">
            <h2>üì¶ Product Inventory</h2>
            <div id="productList"></div>
        </div>

        <div class="card animate-in" style="animation-delay: 0.2s" id="orders">
            <h2>üõçÔ∏è Recent Orders</h2>
            <div id="orderList"></div>
        </div>

        <div class="card animate-in" style="animation-delay: 0.3s" id="settings">
            <h2>‚öôÔ∏è Store Settings</h2>
            <input id="sName" placeholder="Business Name">
            <input id="sTitle" placeholder="Hero Title">
            <input id="sSubtitle" placeholder="Hero Subtitle">
            <button id="settingsBtn">Save Settings</button>
        </div>
    </div>
</div>

<!-- Edit Product Modal -->
<div id="editModal" class="modal" onclick="if(event.target === this) closeEditModal()">
    <div class="modal-content">
        <button class="modal-close" onclick="closeEditModal()">√ó</button>
        <h2>Edit Product</h2>
        <img id="editPreview" class="image-preview" style="display: none;">
        <input id="editName" placeholder="Product Name">
        <input type="number" id="editPrice" placeholder="Price" step="0.01">
        <input type="number" id="editStock" placeholder="Stock Quantity">
        <input type="file" id="editImg" accept="image/*">
        <button id="updateBtn">Update Product</button>
        <button class="secondary" onclick="closeEditModal()">Cancel</button>
    </div>
</div>

<!-- Order Details Modal -->
<div id="orderModal" class="modal" onclick="if(event.target === this) closeOrderModal()">
    <div class="modal-content">
        <button class="modal-close" onclick="closeOrderModal()">√ó</button>
        <div id="orderDetails"></div>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set, push, onValue, remove, update, get } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyAfxtCHxeDz-RQR9vIk2FIORQLKtQ58uC8",
    authDomain: "by-artholic.firebaseapp.com",
    databaseURL: "https://by-artholic-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "by-artholic",
    appId: "1:1082906393096:web:d5a7ab883fc432e624afbd"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
let currentEditId = null;

// Smooth scroll to sections
window.scrollToSection = (sectionId) => {
    const section = document.getElementById(sectionId);
    if (section) {
        section.scrollIntoView({ behavior: 'smooth', block: 'start' });
        
        // Update active nav item
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
        });
        event.target.classList.add('active');
    }
};

async function uploadToCloudinary(file) {
    const fd = new FormData();
    fd.append("file", file);
    fd.append("upload_preset", "products_unsigned");
    const res = await fetch(
        "https://api.cloudinary.com/v1_1/djqu0ajb0/image/upload",
        { method: "POST", body: fd }
    );
    if (!res.ok) throw new Error("Upload failed");
    return (await res.json()).secure_url;
}

// Add Product
saveBtn.onclick = async () => {
    const file = pImg.files[0];
    const name = pName.value.trim();
    const price = parseFloat(pPrice.value);
    const stock = parseInt(pStock.value);

    if (!file || !name || isNaN(price) || isNaN(stock)) {
        alert("Please fill all fields correctly");
        return;
    }

    saveBtn.disabled = true;
    saveBtn.innerText = "Uploading...";

    try {
        const image = await uploadToCloudinary(file);
        await set(push(ref(db, "products")), {
            name,
            price,
            stock,
            image,
            createdAt: Date.now()
        });
        pName.value = '';
        pPrice.value = '';
        pStock.value = '';
        pImg.value = '';
        alert("Product added successfully!");
    } catch (err) {
        alert("Failed to add product: " + err.message);
    } finally {
        saveBtn.disabled = false;
        saveBtn.innerText = "Add Product";
    }
};

// Show Edit Modal
window.editProduct = async (id) => {
    currentEditId = id;
    const snap = await get(ref(db, "products/" + id));
    const p = snap.val();
    if (!p) return;

    editName.value = p.name;
    editPrice.value = p.price;
    editStock.value = p.stock;
    editImg.value = '';
    
    const preview = document.getElementById('editPreview');
    preview.src = p.image;
    preview.style.display = 'block';
    
    document.getElementById('editModal').style.display = 'block';
};

// Update Product
updateBtn.onclick = async () => {
    if (!currentEditId) return;

    const name = editName.value.trim();
    const price = parseFloat(editPrice.value);
    const stock = parseInt(editStock.value);

    if (!name || isNaN(price) || isNaN(stock)) {
        alert("Please fill all fields correctly");
        return;
    }

    updateBtn.disabled = true;
    updateBtn.innerText = "Updating...";

    try {
        const updateData = { name, price, stock };
        
        if (editImg.files[0]) {
            updateData.image = await uploadToCloudinary(editImg.files[0]);
        }

        await update(ref(db, "products/" + currentEditId), updateData);
        alert("Product updated successfully!");
        closeEditModal();
    } catch (err) {
        alert("Failed to update: " + err.message);
    } finally {
        updateBtn.disabled = false;
        updateBtn.innerText = "Update Product";
    }
};

window.closeEditModal = () => {
    document.getElementById('editModal').style.display = 'none';
    currentEditId = null;
};

// Products List
onValue(ref(db, "products"), snap => {
    const list = productList;
    list.innerHTML = "";
    const data = snap.val();
    
    if (!data) {
        list.innerHTML = `
            <div class="empty-state">
                <div class="empty-icon">üì¶</div>
                <p>No products yet. Add your first product above!</p>
            </div>
        `;
        return;
    }

    Object.entries(data).forEach(([id, p]) => {
        const item = document.createElement('div');
        item.className = 'product-item';
        item.innerHTML = `
            <img src="${p.image}" alt="${p.name}" class="product-img">
            <div class="product-info">
                <h3>${p.name}</h3>
                <div class="product-meta">
                    <strong>$${p.price.toFixed(2)}</strong> ‚Ä¢ 
                    ${p.stock > 0 ? 
                        `<span class="badge success-badge">${p.stock} in stock</span>` : 
                        '<span class="badge warning-badge">Out of stock</span>'
                    }
                </div>
            </div>
            <div class="product-actions">
                <button class="secondary" onclick="editProduct('${id}')">Edit</button>
                <button class="danger" onclick="deleteProduct('${id}')">Delete</button>
            </div>
        `;
        list.appendChild(item);
    });
});

window.deleteProduct = async (id) => {
    if (!confirm("Are you sure you want to delete this product?")) return;
    await remove(ref(db, "products/" + id));
    alert("Product deleted!");
};

// Orders
onValue(ref(db, "orders"), snap => {
    const orders = snap.val();
    const list = orderList;
    list.innerHTML = "";
    
    let totalRevenue = 0;

    if (!orders) {
        list.innerHTML = `
            <div class="empty-state">
                <div class="empty-icon">üõçÔ∏è</div>
                <p>No orders yet</p>
            </div>
        `;
        totalRevenue = 0;
    } else {
        Object.values(orders).forEach(o => totalRevenue += o.total);

        Object.entries(orders).reverse().forEach(([id, o]) => {
            const item = document.createElement('div');
            item.className = 'order-item';
            const date = new Date(o.time).toLocaleString();
            item.innerHTML = `
                <div class="order-header">
                    <span class="order-id">#${id.slice(-6).toUpperCase()}</span>
                    <span class="order-total">$${o.total.toFixed(2)}</span>
                </div>
                <div class="customer-info">
                    <strong>${o.customer.name}</strong><br>
                    ${o.customer.email}<br>
                    ${o.customer.address}<br>
                    <small>${date}</small>
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <button class="secondary" style="width: auto; padding: 0.6rem 1.2rem;" onclick="viewOrder('${id}')">View Details</button>
                    <button class="danger" style="width: auto; padding: 0.6rem 1.2rem;" onclick="completeOrder('${id}')">Mark Complete</button>
                </div>
            `;
            list.appendChild(item);
        });
    }

    document.getElementById('totalRevenue').innerText = `$${totalRevenue.toFixed(2)}`;
});

window.viewOrder = async (id) => {
    const snap = await get(ref(db, "orders/" + id));
    const order = snap.val();
    if (!order) return;
    
    let itemsHtml = '<div class="order-items-list">';
    order.items.forEach(item => {
        itemsHtml += `
            <div class="order-item-row">
                <div>
                    <strong>${item.name}</strong><br>
                    <small style="color: #94a3b8;">Quantity: ${item.qty}</small>
                </div>
                <div style="text-align: right;">
                    <strong>$${(item.price * item.qty).toFixed(2)}</strong><br>
                    <small style="color: #94a3b8;">$${item.price.toFixed(2)} each</small>
                </div>
            </div>
        `;
    });
    itemsHtml += '</div>';
    
    document.getElementById('orderDetails').innerHTML = `
        <h2>Order #${id.slice(-6).toUpperCase()}</h2>
        <div style="background: #0f172a; padding: 1.5rem; border-radius: 12px; margin: 1rem 0;">
            <strong>Customer Information</strong><br>
            <div style="margin-top: 1rem; color: #94a3b8; line-height: 1.8;">
                ${order.customer.name}<br>
                ${order.customer.email}<br>
                ${order.customer.address}
            </div>
        </div>
        <h3 style="margin: 1.5rem 0 1rem; color: #f1f5f9;">Order Items</h3>
        ${itemsHtml}
        <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 1.5rem; border-radius: 12px; margin: 1.5rem 0; text-align: center;">
            <div style="font-size: 0.9rem; opacity: 0.9;">Total Amount</div>
            <div style="font-size: 2.5rem; font-weight: 800; margin-top: 0.5rem;">$${order.total.toFixed(2)}</div>
        </div>
        <button class="secondary" onclick="closeOrderModal()">Close</button>
    `;
    
    document.getElementById('orderModal').style.display = 'block';
};

window.closeOrderModal = () => {
    document.getElementById('orderModal').style.display = 'none';
};

window.completeOrder = async (id) => {
    if (!confirm("Mark this order as complete and remove it?")) return;
    await remove(ref(db, "orders/" + id));
    alert("Order completed!");
};

// Settings
settingsBtn.onclick = async () => {
    const name = sName.value.trim();
    const title = sTitle.value.trim();
    const subtitle = sSubtitle.value.trim();
    
    if (!name || !title) {
        alert("Please fill in at least the name and title");
        return;
    }

    await set(ref(db, "settings"), { name, title, subtitle });
    alert("Settings saved successfully!");
};

onValue(ref(db, "settings"), snap => {
    const settings = snap.val();
    if (settings) {
        sName.value = settings.name || '';
        sTitle.value = settings.title || '';
        sSubtitle.value = settings.subtitle || '';
    }
});

// Image preview on file select
editImg.addEventListener('change', (e) => {
    if (e.target.files[0]) {
        const reader = new FileReader();
        reader.onload = (event) => {
            document.getElementById('editPreview').src = event.target.result;
        };
        reader.readAsDataURL(e.target.files[0]);
    }
});
</script>
</body>
</html>